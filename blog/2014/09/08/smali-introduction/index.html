
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Smali和逆向分析 - Jacky's Blog</title>
  <meta name="author" content="FuSijie">

  
  <meta name="description" content="这篇文章其实2个月前就想写了，但并不好写，就懒得写了，所以拖到现在～其实接触smali这门语法是件蛮偶然的事，接触后发现，次奥，这货在某些领域太有用了，至于为什么我想看完这篇文章应该都明白了。 我自己也只是接触了皮毛，大概用了2个礼拜多一点，也不是很系统的学习， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.fusijie.com/blog/2014/09/08/smali-introduction">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jacky's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

<link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jacky's Blog</a></h1>
  
    <h2>Stay Hungry,Stay Foolish!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.fusijie.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/projects">Projects</a></li>
  <li><a href="/tag-cloud/">Tags</a></li>
  <li><a href="http://code.fusijie.com" target="_blank">Code</a></li>
  <li><a href="https://github.com/fusijie" target="_blank">Github</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Smali和逆向分析</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-08T20:37:00+08:00" pubdate data-updated="true">Sep 8<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>这篇文章其实2个月前就想写了，但并不好写，就懒得写了，所以拖到现在～其实接触smali这门语法是件蛮偶然的事，接触后发现，次奥，这货在某些领域太有用了，至于为什么我想看完这篇文章应该都明白了。</p>

<p>我自己也只是接触了皮毛，大概用了2个礼拜多一点，也不是很系统的学习，写这篇的目的主要还是想把知道的东西记下来，以后好追溯。</p>

<h3>1.Smali简介</h3>

<p>Smali是Dalvik的寄存器语言，它与Java的关系，简单理解就是汇编之于C。假如你对汇编有足够的驾驭能力，那你可以通过修改汇编代码来改变C/C++代码的走向。当然，学过汇编的都清楚，汇编比<a href="http://www.muppetlabs.com/~breadbox/bf/">BrainFuck</a>还难学，更不用说去反编译修改了。</p>

<p>但是Smali有一点不一样，就是它很简单，只有一点点的语法，只要你会java，了解Android的相关知识，那你完全可以通过修改Smali代码来反向修改java代码，虽然绕了一点，但是在某些情况下你不得不这么做。还好，Smali很简单。</p>

<!-- more -->


<h3>2.apktool</h3>

<p>说了这么多，还没有说Smali哪来？没错。Smali代码是安卓APK反编译而来的，所以Smali文件和Java文件一一对应。获取Smali文件，我们需要下载一个辅助工具：<a href="https://code.google.com/p/android-apktool/downloads/list">ApkTool</a>。apktool这个命令行工具如果详细使用功能参数是比较多的，但是这里我们只需要用到2个最基础的功能：</p>

<p>一个是反编译decode：</p>

<pre><code>apktool d xxx.apk
</code></pre>

<p>另一个是打包build：</p>

<pre><code>apktool b
</code></pre>

<p>这里要注意的是路径问题，apktool如果没有加入到环境变量中，记得cd到apktool的目录去使用它。另一个是打包，如果只是简单的使用参数b，那要求是要在反编译出来的项目目录下执行，而打包好的文件会保存在这个项目目录下的dist目录。</p>

<p>这是一个HelloWorld的应用程序反编译和打包的目录结构：</p>

<div align="center"><img src="http://www-fusijie-com.qiniudn.com/smali_Screen%20Shot%202014-09-08%20at%209.42.35%20PM.png" alt="" border="0" title="" /><br></br></div>




<div align="center"><img src="http://www-fusijie-com.qiniudn.com/smali_Screen%20Shot%202014-09-08%20at%209.43.37%20PM.png" alt="" border="0" title="" /><br></br></div>


<h3>3.Smali语法</h3>

<p>这里仍然以一个默认的HelloWorld的应用程序进行解释吧。新建一个HelloWorld安卓项目，在MainActivity中只保留onCreate函数。代码如下：</p>

<figure class='code'><figcaption><span>MainActivity.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">fusijie</span><span class="o">.</span><span class="na">helloworld</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'>  <span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>反编译后的Smali文件如下：</p>

<figure class='code'><figcaption><span>MainActivity.smali</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='smali'><span class='line'><span class="k">    .class</span> <span class="k">public</span> <span class="kt">L</span>com/fusijie/helloworld/<span class="nc">MainActivity</span>;
</span><span class='line'><span class="k">  .super</span> <span class="kt">L</span>android/app/<span class="nc">Activity</span>;
</span><span class='line'><span class="k">  .source</span> <span class="s">&quot;MainActivity.java&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># direct methods</span>
</span><span class='line'><span class="k">  .method</span> <span class="k">public</span> <span class="k">constructor</span> <span class="nf">&lt;init&gt;</span><span class="p">()</span><span class="kt">V</span>
</span><span class='line'><span class="k">    .locals</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="k">    .prologue</span>
</span><span class='line'><span class="k">    .line</span> <span class="mi">14</span>
</span><span class='line'>    invoke-direct <span class="p">{</span><span class="nb">p0</span><span class="p">},</span> <span class="kt">L</span>android/app/<span class="nc">Activity</span>;<span class="p">-&gt;</span><span class="nf">&lt;init&gt;</span><span class="p">()</span><span class="kt">V</span>
</span><span class='line'>
</span><span class='line'>    return-void
</span><span class='line'>  <span class="p">.</span>end method
</span><span class='line'>
</span><span class='line'>  <span class="c"># virtual methods</span>
</span><span class='line'><span class="k">  .method</span> <span class="k">protected</span> <span class="nf">onCreate</span><span class="p">(</span><span class="kt">L</span>android/os/<span class="nc">Bundle</span>;<span class="p">)</span><span class="kt">V</span>
</span><span class='line'><span class="k">    .locals</span> <span class="mi">1</span>
</span><span class='line'><span class="k">    .parameter</span> <span class="s">&quot;savedInstanceState&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">    .prologue</span>
</span><span class='line'><span class="k">    .line</span> <span class="mi">18</span>
</span><span class='line'>    invoke-super <span class="p">{</span><span class="nb">p0</span><span class="p">,</span> <span class="nb">p1</span><span class="p">},</span> <span class="kt">L</span>android/app/<span class="nc">Activity</span>;<span class="p">-&gt;</span><span class="nf">onCreate</span><span class="p">(</span><span class="kt">L</span>android/os/<span class="nc">Bundle</span>;<span class="p">)</span><span class="kt">V</span>
</span><span class='line'>
</span><span class='line'><span class="k">    .line</span> <span class="mi">19</span>
</span><span class='line'>    const/high16 <span class="nb">v0</span><span class="p">,</span> <span class="mh">0x7f03</span>
</span><span class='line'>
</span><span class='line'>    invoke-virtual <span class="p">{</span><span class="nb">p0</span><span class="p">,</span> <span class="nb">v0</span><span class="p">},</span> <span class="kt">L</span>com/fusijie/helloworld/<span class="nc">MainActivity</span>;<span class="p">-&gt;</span><span class="nf">setContentView</span><span class="p">(</span><span class="kt">I</span><span class="p">)</span><span class="kt">V</span>
</span><span class='line'>
</span><span class='line'><span class="k">    .line</span> <span class="mi">20</span>
</span><span class='line'>    return-void
</span><span class='line'>  <span class="p">.</span>end method
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>对比一下，可以比较清楚的看出来，smali代码其实就是对java代码一个翻译，只是没有java看起来那么简单，smali把很多应该复杂的东西还原成复杂的状态了。简单解释下这段代码。</p>

<ul>
<li>前三行指明了类名，父类名，和源文件名。</li>
<li>类名以“L”开头相信熟悉Jni的童鞋都比较清楚。</li>
<li>“#”是smali中的注释。</li>
<li>“.method”和“.end method”类似于Java中的大括号，包含了方法的实现代码段。</li>
<li>方法的括号后面指明了返回类型，这同样类似与Jni的调用。</li>
<li>“.locals”指明了这个方法用到的寄存器数量，当然寄存器可以重复利用，从“V0”起算。</li>
<li>“.prologue”指定了代码开始处。</li>
<li>“.line”表明这是在java源码中的第几行，其实这个值无所谓是多少，可以任意修改，主要用于调试。</li>
<li>“invoke-direct”这是对方法的调用，可以看到这里调用了是Android.app.Activity的init方法，这在java里是隐式调用的。</li>
<li>“return-void”表明了返回类型，这和java不一样，即使没有返回值，也需要这样写。</li>
<li>接下来是onCreate方法，“.parameter”指明了参数名，但是一般没有用，需要注意的是p0代表的是this，p1开始代表函数参数，静态函数没有this，所以从p0开始就代表参数。</li>
<li>在实现里先是调用了父类的方法，然后再调用setContentView，注意这里给了一个传参。整形的传参，这个值是先赋给寄存器v0，然后再调用的使用传递进去的。smali中都是这么使用，所有的值必须通过寄存器来中转。这点和汇编很像。</li>
</ul>


<p>对比了Java代码和Smali代码，可以很清楚的看到，原本只有几行的代码到了Smali，内容被大大扩充了。Smali还原了Java隐藏的东西，同时显式地指定了很多细节。这还只是个最基本的HelloWorld的onCreate函数，如果有内部类，还会分文件显示。</p>

<p>这样看来，其实Smali只能说复杂，不能说难。我这里不打算把Smali的语法再贴一次，这里给出几个链接，算是总结的相对好一点的（其实我都没看到有系统总结的。。。如果你有好的资料，欢迎跟帖分享）</p>

<ul>
<li><a href="http://liuzhichao.com/p/tag/smali">Smali语法&mdash;数据类型、方法、字段和寄存器</a></li>
<li><a href="http://book.2cto.com/201212/12468.html">Android软件安全与逆向分析&mdash;Smali文件格式</a></li>
<li><a href="http://blog.csdn.net/wdaming1986/article/details/8299996">Smali&mdash;Dalvik虚拟机指令语言</a></li>
<li><a href="http://bbs.pediy.com/showthread.php?t=151769">看雪论坛&mdash;关于Smali语法</a></li>
</ul>


<p>这里顺便提供2个利器：</p>

<ul>
<li><a href="http://liuzhichao.com/p/1476.html">Smali Sublime Text语法高亮插件</a></li>
<li><a href="https://code.google.com/p/dex2jar/">dex2jar，配合Smali事半功倍</a></li>
</ul>


<h3>4.小试牛刀</h3>

<p>了解了Smali的基本语法，那我们要动手试一下，Smali能做什么？仍然以HelloWorld为例，假如我们没有Android项目的源代码，只有一个APK，给他加个新功能吧！</p>

<p>这个功能很简单，只是在HelloWorld中输出一个“Hello, Smali”。</p>

<p>(1)第一步还是先使用apktool来反编译HelloWorld.apk。</p>

<p>(2)打开smali下的com/fusijie/helloworld/MainActivity.smali文件。</p>

<p>(3)原本我们在Java中要写的代码是：</p>

<figure class='code'><figcaption><span>Toast</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;Hello, Smali&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>翻译成Smali就是：</p>

<figure class='code'><figcaption><span>Toast</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='smali'><span class='line'><span class="k">    .line</span> xx
</span><span class='line'>    const-string <span class="nb">v0</span><span class="p">,</span> <span class="s">&quot;Hello, Smali&quot;</span>
</span><span class='line'>
</span><span class='line'>    const/4 <span class="nb">v1</span><span class="p">,</span> <span class="mh">0x1</span>
</span><span class='line'>
</span><span class='line'>    invoke-static <span class="p">{</span><span class="nb">p0</span><span class="p">,</span> <span class="nb">v0</span><span class="p">,</span> <span class="nb">v1</span><span class="p">},</span> <span class="kt">L</span>android/widget/<span class="nc">Toast</span>;<span class="p">-&gt;</span><span class="nf">makeText</span><span class="p">(</span><span class="kt">L</span>android/content/<span class="nc">Context</span>;<span class="kt">L</span>java/lang/<span class="nc">CharSequence</span>;<span class="kt">I</span><span class="p">)</span><span class="kt">L</span>android/widget/<span class="nc">Toast</span>;
</span><span class='line'>
</span><span class='line'>    move-result-object <span class="nb">v0</span>
</span><span class='line'>
</span><span class='line'>    invoke-virtual <span class="p">{</span><span class="nb">v0</span><span class="p">},</span> <span class="kt">L</span>android/widget/<span class="nc">Toast</span>;<span class="p">-&gt;</span><span class="nf">show</span><span class="p">()</span><span class="kt">V</span>
</span></code></pre></td></tr></table></div></figure>


<p>(4)最后在插入Smali的时候，我们需要修改2个地方：</p>

<ul>
<li>“.locals 1”，因为本来只用到了v0，现在多用了一个v1，所以改为“.locals 2”。</li>
<li>“.line xx” xx随意改为一个不重复的值即可。</li>
</ul>


<p>(5)使用apktool打包成apk，因为打包完后原有的密钥会丢失，所以需要重新打上我们自己的密钥，可以参考<a href="http://www.eoeandroid.com/forum.php?mod=viewthread&amp;tid=300764">很早以前我写的一个帖子</a>。</p>

<p>(6)最后的效果是这样的。</p>

<div align="center"><img src="http://www-fusijie-com.qiniudn.com/smali_Screen%20Shot%202014-09-08%20at%2011.00.38%20PM.png" alt="" border="0" title="" /><br></br></div>


<h3>5.干点坏事</h3>

<p>从上面一个例子对Smali的用途就很清楚了，没错，Smali注入。现在常见的除了测试以外的用途，Smali注入明显是带有黑客性质的，小的如破解游戏，替换游戏广告，大的甚至利用漏洞去破解密码，偷窃个人资料，财产等等。对Smali，安卓逆向分析，安卓系统安全比较清楚的，这些事其实都不算事。</p>

<p>我这里以一个实际上线的游戏破解为例，看看我们平时在写代码时要注意哪些问题，避免辛辛苦苦写游戏，却在帮人家数钱。这里的破解不是重点，反破解才是重点。</p>

<p>以市场上很火的一款单机游戏《消灭小星星》为例，下载地址是：<a href="http://apk.91.com/Soft/Android/com.brianbaek.popstar-340.html">http://apk.91.com/Soft/Android/com.brianbaek.popstar-340.html</a></p>

<p>相同的方法反编译，在/smali/com/zplay/android/sdk/pay/ZplayPay.smali文件的dopay函数开头，注入如下代码：</p>

<figure class='code'><figcaption><span>popstar_crack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='smali'><span class='line'>    const/4 <span class="nb">v0</span><span class="p">,</span> <span class="mh">0x1</span>  
</span><span class='line'>    invoke-static <span class="p">{</span><span class="nb">v0</span><span class="p">},</span> <span class="kt">L</span>com/zplay/iap/<span class="nc">ZplayJNI</span>;<span class="p">-&gt;</span><span class="nf">sendMessage</span><span class="p">(</span><span class="kt">I</span><span class="p">)</span><span class="kt">V</span>
</span><span class='line'>    return-void
</span></code></pre></td></tr></table></div></figure>


<p>原理很简单，这个游戏使用了Zplay的支付系统，在Java层的处理了支付逻辑，如果觉得Smali读起来费劲，那么直接使用dex2jar就能很清楚的看到，支付提醒甚至是中文的。Java层处理完支付逻辑后会给C++层丢个消息，调用C++层的代码去处理游戏逻辑，比如成功支付，那么幸运星就会相应地增加。这里使用native方法进行处理。</p>

<p>所以注入的代码是，一旦进入支付逻辑，直接返回成功，同时强制返回函数，这就实现了支付的破解。当然作为一个有节操，有逼格的游戏从业者，这里就不放出破解版了（不过说得也够明白了）。查找注入点这东西靠的是耐心，细心和运气。</p>

<p>为了方便，一般会先用正常的java写一些调试类，然后反编译出静态的smali放入目标文件夹中以供调试使用。</p>

<p>再放张图，星星用不完了：</p>

<div align="center"><img src="http://www-fusijie-com.qiniudn.com/smali_crack_popstar.jpg" alt="" border="0" title="" /><br></br></div>


<h3>6.总结</h3>

<p>就像上面说的，Smali能做的不仅仅是这些。有兴趣的可以看看这篇文章<a href="http://blog.csdn.net/hu3167343/article/details/36418063">《支付宝钱包手势密码破解实战》</a>，我没有去验证过真伪，但是如作者所描述的应该是可行无误。这里用到的一个更高级的功能是将支付宝的加密解密逻辑Smali的jar包导入自己新建的工程，进而直接在自己的程序中集成支付宝的加密解密功能。</p>

<p>在逆向分析游戏的过程中，我也发现了几个重要的点能帮助开发者提高自己程序的安全性。</p>

<p>首先，完全避免破解是不可能的，我们能做的工作就是尽最大可能去妨碍破解者破解游戏，提高破解成本。</p>

<ul>
<li>一定要使用混淆。不单单是第三方SDK，你的代码也是。破解游戏很重要一点就是要抓住游戏的逻辑。代码混淆后，Smali更加晦涩难懂，逻辑也更难掌握。</li>
<li>回到开头的话，解读汇编比解读Smali难度大的多得多。所以重要的逻辑可以放到C/C++层去处理就不要放在Java层上去处理。</li>
<li>多用连续调用的方式。这样出来的效果是Java只有一行，Smali可能有好几十行，看着都蛋疼。当然这对熟练的破解老手无效～</li>
<li>在一些关键的点上，比如支付，多绕一下。而不是像《消灭小星星》这样，直接在Java内用中文显示“支付成功”，同时去调用JNI方法。用dex2jar看一眼就暴露了。</li>
</ul>


<p>哈哈，总之，小心你的艳照。。。</p>

<p>哇咔咔，竟然写了快4个小时～</p>

<p class='post-footer'>&nbsp;原文地址：<a href='http://www.fusijie.com/blog/2014/09/08/smali-introduction/'>http://www.fusijie.com/blog/2014/09/08/smali-introduction/</a><br/>&nbsp;版权声明：自由转载-非商用-非衍生-保持署名| <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh'>Creative Commons BY-NC-ND 3.0</a></p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">FuSijie</span></span>

      








  


<time datetime="2014-09-08T20:37:00+08:00" pubdate data-updated="true">Sep 8<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>Android</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
      <!-- JiaThis Button BEGIN -->
  <section>
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share?uid=1859056" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1859056" charset="utf-8"></script>
</section>
<!-- JiaThis Button END -->
  
</div>

    
    <p class="meta">
      
	    <p></p>
        <a class="basic-alignment left" href="/blog/2014/09/02/cocos2dx-faq-2/" title="Previous Post: Cocos2dx-FAQ-2">&laquo; Cocos2dx-FAQ-2</a>
      
      
	    <p></p>
        <a class="basic-alignment right" href="/blog/2014/10/08/what-is-a-commit-hash/" title="Next Post: (译)第一部分：什么是commit hash?">(译)第一部分：什么是commit hash? &raquo;</a>
      
    </p>
  </footer>
</article>
  <section>
      <div id="duoshuo_thread" aria-live="polite"><!-- Duoshuo Comment BEGIN -->
<div class="ds-thread" data-thread-key="/blog/2014/09/08/smali-introduction/" data-title="Smali和逆向分析"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"fusijie"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
<!-- Duoshuo Comment END --></div>
</section>
</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
		<br>
		<center><a target="_blank" href="http://blog.csdn.net/jackystudio" style="text-decoration:none" ><img src="\images\aboutme.png" border=0></img></a></center>
		</br>
</section><section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/android/'>Android (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx-faq/'>Cocos2dx-FAQ (2)</a></li>
<li class='category'><a href='/blog/categories/lua/'>Lua (1)</a></li>
<li class='category'><a href='/blog/categories/tools/'>Tools (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2d-x/'>cocos2d-x (37)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (3)</a></li>

  </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/18/what-is-a-rebase/">(译)第三部分：什么是rebase?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/15/what-is-a-merge/">(译)第二部分：什么是merge?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/08/what-is-a-commit-hash/">(译)第一部分：什么是commit Hash?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/08/smali-introduction/">Smali和逆向分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/02/cocos2dx-faq-2/">Cocos2dx-FAQ-2</a>
      </li>
    
  </ul>
</section>




  <section>
<h1>Recent Comments</h1>
<ul class="ds-recent-comments" data-num-items="10" data-show-avatars="1" data-show-time="1" data-show-admin="1" data-excerpt-length="70"></ul>
<!--多说js加载开始，一个页面只需要加载一次 -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"fusijie"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!--多说js加载结束，一个页面只需要加载一次 -->
</section>
<section>
  <h1>Sina Weibo</h1>
  <ul id="weibo">
    <li>
      <iframe 
        width="100%" 
        height="450" 
        class="share_self" 
        frameborder="0" 
        scrolling="no" 
        src="http://widget.weibo.com/weiboshow/index.php?width=0&height=450&fansRow=0&ptype=1&speed=0&skin=&isTitle=0&noborder=1&isWeibo=1&isFans=0&uid=1307211523&verifier=3619ee9c">
      </iframe>
    </li>
  </ul>
</section>
 
<section>
<h1>Visitor</h1>
<div>
	<p></p>
    <center>
	<a href="http://info.flagcounter.com/3pF8"><img src="http://s08.flagcounter.com/count/3pF8/bg_FFFFFF/txt_000000/border_CCCCCC/columns_3/maxflags_12/viewers_3/labels_0/pageviews_1/flags_0/" alt="Flag Counter" border="0"></a>
	</center>
</div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - FuSijie -
  <span class="credit">牛逼自豪有情怀地使用高大上的 <a href="http://octopress.org">Octopress</a></span>
  <script type="text/javascript">
	var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
	document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F966a6a480d428ebd0c0c55fcfb4f8a88' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</footer>
  <div id="full" style="width:0px; height:0px; position:fixed; right:70px; bottom:70px; z-index:100; text-align:center; background-color:transparent; cursor:pointer;">
        <a href="#" onclick="goTop();return false;"><img src="/images/top.png" border=0 alt="Top"></a>
</div>
<script src="/javascripts/top.js" type="text/javascript"></script>
  











</body>
</html>
